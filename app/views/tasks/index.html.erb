<div class="container mx-auto px-4 py-8">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-gray-900">
      <% if @project %>
        Tasks for "<%= @project.name %>"
      <% else %>
        All Tasks
      <% end %>
    </h1>

    <div class="flex gap-3">
      <% if @project %>
        <%= link_to "New Task", new_project_task_path(@project),
                    class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" %>
        <%= link_to "Back to Project", project_path(@project),
                    class: "bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded" %>
      <% else %>
        <%= link_to "New Task", new_task_path,
                    class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" %>
      <% end %>
    </div>
  </div>

  <!-- Task Status Filter -->
  <div class="mb-6">
    <div class="flex flex-wrap gap-2">
      <%= link_to "All (#{@task_counts[:all]})",
                  @project ? project_tasks_path(@project) : tasks_path,
                  class: "px-3 py-1 rounded-full text-sm #{params[:status].blank? ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}" %>

      <%= link_to "Pending (#{@task_counts[:pending]})",
                  @project ? project_tasks_path(@project, status: 'pending') : tasks_path(status: 'pending'),
                  class: "px-3 py-1 rounded-full text-sm #{params[:status] == 'pending' ? 'bg-yellow-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}" %>

      <%= link_to "In Progress (#{@task_counts[:in_progress]})",
                  @project ? project_tasks_path(@project, status: 'in_progress') : tasks_path(status: 'in_progress'),
                  class: "px-3 py-1 rounded-full text-sm #{params[:status] == 'in_progress' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}" %>

      <%= link_to "Completed (#{@task_counts[:completed]})",
                  @project ? project_tasks_path(@project, status: 'completed') : tasks_path(status: 'completed'),
                  class: "px-3 py-1 rounded-full text-sm #{params[:status] == 'completed' ? 'bg-green-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}" %>
    </div>
  </div>

  <!-- Tasks List -->
  <% if @tasks.any? %>
    <div class="grid gap-4">
      <% @tasks.each do |task| %>
        <div class="bg-white shadow-md rounded-lg p-6 border-l-4
                    <%= case task.status
                        when 'pending' then 'border-yellow-400'
                        when 'in_progress' then 'border-blue-400'
                        when 'completed' then 'border-green-400'
                        when 'cancelled' then 'border-red-400'
                        end %>">

          <div class="flex justify-between items-start mb-3">
            <h3 class="text-xl font-semibold text-gray-900">
              <%= link_to task.title, task_path(task), class: "hover:text-blue-600" %>
            </h3>

            <div class="flex items-center gap-2">
              <!-- Priority Badge -->
              <span class="px-2 py-1 text-xs font-semibold rounded-full
                         <%= case task.priority
                             when 'low' then 'bg-gray-100 text-gray-800'
                             when 'medium' then 'bg-yellow-100 text-yellow-800'
                             when 'high' then 'bg-orange-100 text-orange-800'
                             when 'urgent' then 'bg-red-100 text-red-800'
                             end %>">
                <%= task.priority.humanize %>
              </span>

              <!-- Status Badge -->
              <span class="px-2 py-1 text-xs font-semibold rounded-full
                         <%= case task.status
                             when 'pending' then 'bg-yellow-100 text-yellow-800'
                             when 'in_progress' then 'bg-blue-100 text-blue-800'
                             when 'completed' then 'bg-green-100 text-green-800'
                             when 'cancelled' then 'bg-red-100 text-red-800'
                             end %>">
                <%= task.status.humanize %>
              </span>
            </div>
          </div>

          <p class="text-gray-600 mb-3"><%= truncate(task.description, length: 150) %></p>

          <div class="flex justify-between items-center text-sm text-gray-500">
            <div class="flex items-center gap-4">
              <% if !@project && task.projects.any? %>
                <span>Projects:
                  <%= task.projects.map { |p| link_to p.name, project_path(p), class: "text-blue-600 hover:text-blue-800" }.join(", ").html_safe %>
                </span>
              <% end %>

              <% if task.due_date %>
                <span class="<%= task.due_date < Date.current ? 'text-red-600 font-semibold' : '' %>">
                  Due: <%= task.due_date.strftime('%B %d, %Y') %>
                </span>
              <% end %>
            </div>

            <div class="flex gap-2">
              <%= link_to "Edit", edit_task_path(task),
                          class: "text-blue-600 hover:text-blue-800" %>
              <%= link_to "Delete", task_path(task), method: :delete,
                          data: { confirm: "Are you sure?" },
                          class: "text-red-600 hover:text-red-800" %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="text-center py-12">
      <div class="text-gray-400 text-6xl mb-4">📝</div>
      <h3 class="text-xl font-semibold text-gray-600 mb-2">No tasks found</h3>
      <p class="text-gray-500 mb-4">
        <% if @project %>
          This project doesn't have any tasks yet.
        <% else %>
          You haven't created any tasks yet.
        <% end %>
      </p>
      <%= link_to "Create your first task",
                  @project ? new_project_task_path(@project) : new_task_path,
                  class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" %>
    </div>
  <% end %>
</div>